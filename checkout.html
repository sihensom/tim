<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.16/tailwind.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="font-poppins bg-gray-50">

    <!-- Header -->
    <header class="bg-white shadow-md mb-8">
        <div class="container mx-auto py-4">
            <h1 class="text-3xl font-bold text-center text-gray-800">Checkout</h1>
        </div>
    </header>

    <main>
        <div class="container mx-auto mt-8 mb-16">
            <div class="bg-white rounded-lg shadow-lg p-8 lg:p-12">
                <form id="checkout-form" class="space-y-6">
                    
                    <!-- Buyer Information -->
                    <div class="form-group">
                        <label for="buyer-name" class="block font-medium text-lg text-gray-700 mb-2">Nama Pembeli:</label>
                        <input type="text" id="buyer-name" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required placeholder="Masukkan nama lengkap">
                    </div>

                    <div class="form-group">
                        <label for="address" class="block font-medium text-lg text-gray-700 mb-2">Alamat:</label>
                        <textarea id="address" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required placeholder="Masukkan alamat lengkap"></textarea>
                    </div>

                    <!-- Payment Options -->
                    <div class="form-group">
                        <label class="block font-medium text-lg text-gray-700 mb-4">Metode Pembayaran:</label>
                        <div class="space-y-4">
                            <!-- COD Option -->
                            <div class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors" onclick="selectPayment('cod')">
                                <input type="radio" id="cod" name="payment" value="cod" class="h-4 w-4 text-blue-600" required>
                                <label for="cod" class="ml-3 flex flex-1 cursor-pointer">
                                    <div>
                                        <span class="block font-medium text-gray-700">Cash on Delivery (COD)</span>
                                        <span class="text-sm text-gray-500">Bayar saat barang sampai</span>
                                    </div>
                                </label>
                            </div>

                            <!-- QRIS Option -->
                            <div class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors" onclick="selectPayment('qris')">
                                <input type="radio" id="qris" name="payment" value="qris" class="h-4 w-4 text-blue-600">
                                <label for="qris" class="ml-3 flex flex-1 cursor-pointer">
                                    <div>
                                        <span class="block font-medium text-gray-700">QRIS</span>
                                        <span class="text-sm text-gray-500">Pembayaran melalui scan QR code</span>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Order Summary -->
                    <div class="bg-gray-100 rounded-lg p-6">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Ringkasan Pesanan</h2>
                        <div class="space-y-4" id="order-summary">
                            <!-- Products will be added here through JavaScript -->
                        </div>

                        <div class="border-t pt-4 mt-4">
                            <p class="text-right font-medium text-lg text-gray-700">Total: <span id="total-price" class="font-bold text-blue-600"></span></p>
                        </div>
                    </div>

                    <!-- Checkout Buttons -->
                    <div class="flex justify-between items-center mt-8">
                        <button type="button" onclick="completeCheckout()" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-500 text-white font-semibold py-3 px-6 rounded-md transition-all duration-300 transform hover:scale-105">Beli</button>
                        <button type="button" onclick="goBack()" class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 px-6 rounded-md transition-all duration-300 transform hover:scale-105">Kembali</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <script>
       // Add this function to handle adding items to cart/checkout
function addToCheckout(product) {
    // Get existing checkout data or initialize empty array
    let checkoutData = JSON.parse(localStorage.getItem('checkoutData')) || [];
    
    // Ensure checkoutData is an array
    if (!Array.isArray(checkoutData)) {
        checkoutData = [];
    }
    
    // Add the product to checkout data
    checkoutData.push({
        id: product.id,
        name: product.name,
        price: product.price,
        quantity: product.quantity || 1,
        image: product.image,
        total: product.price * (product.quantity || 1)
    });
    
    // Save to localStorage
    localStorage.setItem('checkoutData', JSON.stringify(checkoutData));
}

// Updated checkout page initialization
document.addEventListener('DOMContentLoaded', function() {
    // Get checkout data from localStorage
    const checkoutData = JSON.parse(localStorage.getItem('checkoutData')) || [];
    
    // Validate if data exists
    if (!checkoutData || checkoutData.length === 0) {
        alert('Tidak ada produk dalam keranjang');
        window.location.href = 'Puki.php'; // Redirect to home if cart is empty
        return;
    }

    // Calculate total
    const totalPrice = checkoutData.reduce((total, item) => total + (item.price * item.quantity), 0);
    
    // Update total price display
    const totalPriceElement = document.getElementById('total-price');
    if (totalPriceElement) {
        totalPriceElement.textContent = 'Rp ' + totalPrice.toLocaleString();
    }

    // Display order items
    const orderSummary = document.getElementById('order-summary');
    if (orderSummary) {
        orderSummary.innerHTML = ''; // Clear existing content
        
        checkoutData.forEach(item => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'flex items-center bg-white shadow-sm p-4 rounded-lg mb-4';
            itemDiv.innerHTML = `
                <img src="${item.image || 'placeholder.jpg'}" alt="${item.name}" 
                     class="w-20 h-20 object-cover rounded-md mr-4">
                <div class="flex-1">
                    <h3 class="font-semibold text-gray-800">${item.name}</h3>
                    <p class="text-gray-500">Rp ${item.price.toLocaleString()}</p>
                    <p class="text-sm text-gray-600 mt-1">Quantity: 
                        <span class="font-medium">${item.quantity}</span>
                    </p>
                    <p class="text-sm text-gray-600">Subtotal: 
                        <span class="font-medium">Rp ${(item.price * item.quantity).toLocaleString()}</span>
                    </p>
                </div>
            `;
            orderSummary.appendChild(itemDiv);
        });
    }

    // Handle form submission
    const checkoutForm = document.getElementById('checkout-form');
    if (checkoutForm) {
        checkoutForm.addEventListener('submit', function(e) {
            e.preventDefault();
            completeCheckout();
        });
    }
});

// Updated complete checkout function
function completeCheckout() {
    const buyerName = document.getElementById('buyer-name').value;
    const address = document.getElementById('address').value;
    const paymentMethod = document.querySelector('input[name="payment"]:checked');

    if (!buyerName || !address) {
        alert('Mohon lengkapi data pembeli');
        return;
    }

    if (!paymentMethod) {
        alert('Silakan pilih metode pembayaran');
        return;
    }

    const checkoutData = JSON.parse(localStorage.getItem('checkoutData')) || [];
    const totalPrice = checkoutData.reduce((total, item) => total + (item.price * item.quantity), 0);

    const invoiceData = {
        buyerName,
        address,
        items: checkoutData,
        totalPrice,
        paymentMethod: paymentMethod.value,
        orderDate: new Date().toISOString(),
        orderNumber: generateOrderNumber()
    };

    // Save invoice data
    localStorage.setItem('invoiceData', JSON.stringify(invoiceData));
    
    // Clear checkout data
    localStorage.removeItem('checkoutData');
    
    // Redirect to invoice page
    window.location.href = 'nota.html';
}

// Helper function to generate order number
function generateOrderNumber() {
    const date = new Date();
    const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
    return `INV${date.getFullYear()}${(date.getMonth()+1).toString().padStart(2, '0')}${date.getDate().toString().padStart(2, '0')}-${random}`;
}
    </script>
</body>
</html>